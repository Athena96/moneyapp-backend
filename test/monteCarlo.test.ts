import { Account } from "../src/models/Account";
import { Allocations } from "../src/models/Allocations";
import { Asset } from "../src/models/Asset";
import { AssetAllocation } from "../src/models/AssetAllocation";
import { Budget } from "../src/models/Budget";
import { Category } from "../src/models/Category";
import { CategoryTypes } from "../src/models/CategoryTypes";
import { Event } from "../src/models/Event";
import { Input } from "../src/models/Input";
import { BalanceData } from "../src/models/MonteCarloTypes";
import { Simulation } from "../src/models/Simulation";
import { SimulationStatus } from "../src/models/SimulationTypes";
import { dateRange } from "../src/utilities/helpers";
import { MonteCarloInputs, projectWithReturn } from "../src/utilities/MonteCarlo";



describe('Helpers tests', function () {

    const growthRates = [

        0.028,
        0.006,
        0.012,
        0.004,
        0.007,
        0.006,
        -0.007,
        0.017,
        -0.010,
        -0.011,
        0.015,
        0.006,
        0.020,
        -0.003,
        0.009,
        -0.002,
        0.009,
        0.011,
        -0.005,
        0.005,
        -0.002,
        0.006,
        -0.012,
        0.011,
        0.022,
        0.021,
        0.000,
        -0.003,
        0.015,
        0.016,
        0.002,
        0.007,
        0.012,
        0.014,
        0.000,
        0.011,
        -0.001,
        -0.007,
        -0.006,
        0.022,
        0.011,
        -0.009,
        -0.007,
        0.010,
        0.030,
        -0.027,
        0.011,
        0.002,
        0.003,
        -0.017,
        -0.011,
        0.019,
        0.010,
        0.015,
        -0.001,
        0.026,
        0.006,
        0.019,
        0.005,
        0.012,
        0.006,
        0.037,
        -0.012,
        0.004,
        0.001,
        0.010,
        0.009,
        -0.000,
        0.019,
        0.017,
        -0.004,
        0.025,
        -0.004,
        0.006,
        0.007,
        -0.009,
        0.022,
        0.005,
        0.015,
        -0.001,
        0.004,
        0.018,
        0.028,
        0.017,
        0.012,
        0.010,
        0.024,
        -0.007,
        0.007,
        0.008,
        0.014,
        -0.017,
        0.030,
        0.016,
        0.023,
        0.015,
        0.013,
        -0.012,
        0.002,
        -0.015,
        0.032,
        0.000,
        -0.022,
        0.012,
        0.009,
        -0.007,
        -0.004,
        -0.006,
        0.026,
        0.015,
        -0.000,
        0.033,
        0.003,
        0.020,
        -0.007,
        -0.007,
        0.026,
        -0.000,
        0.002,
        0.003,
        0.029,
        0.006,
        0.003,
        0.018,
        0.012,
        0.020,
        -0.022,
        0.020,
        0.007,
        0.032,
        -0.007,
        0.019,
        0.010,
        0.005,
        0.012,
        0.000,
        0.003,
        0.003,
        -0.003,
        0.005,
        -0.013,
        0.010,
        -0.015,
        -0.010,
        0.003,
        0.010,
        0.006,
        0.005,
        -0.015,
        -0.002,
        0.008,
        -0.012,
        -0.003,
        0.005,
        0.013,
        -0.006,
        -0.014,
        -0.009,
        0.012,
        0.002,
        0.000,
        -0.006,
        0.020,
        0.002,
        0.006,
        0.025,
        0.008,
        -0.007,
        0.008,
        0.007,
        0.015,
        0.014,
        0.000,
        0.008,
        0.007,
        0.010,
        0.012,
        -0.008,
        0.028,
        0.036,
        0.021,
        -0.008,
        -0.001,
        0.017,
        0.013,
        0.012,
        -0.009,
        0.020,
        0.038,
        -0.005,
        -0.002,
        0.001,
        0.001,
        -0.002,
        -0.012,
        0.005,
        0.013,
        0.027,
        0.016,
        -0.014,
        0.029,
        -0.013,
        0.017,
        0.009,
        0.015,
        -0.008,
        0.004,
        0.011,
        0.004,
        0.006,
        0.020,
        -0.004,
        -0.003,
        -0.008,
        0.016,
        0.009,
        -0.011,
        -0.000,
        -0.000,
        0.002,
        -0.002,
        0.015,
        -0.000,
        0.018,
        0.010,
        -0.014,
        0.028,
        -0.006,
        -0.016,
        0.018,
        0.016,
        0.008,
        0.017,
        0.011,
        0.034,
        0.014,
        0.004,
        0.008,
        0.020,
        0.012,
        -0.014,
        0.012,
        -0.010,
        0.010,
        -0.021,
        0.009,
        0.018,
        -0.005,
        0.018,
        0.040,
        0.022,
        -0.011,
        0.027,
        0.012,
        -0.003,
        -0.008,
        -0.007,
        0.012,
        0.002,
        -0.004,
        0.008,
        0.009,
        -0.012,
        0.007,
        0.001,
        -0.011,
        -0.002,
        -0.005,
        0.027,
        -0.007,
        0.018,
        0.008,
        0.013,
        0.007,
        -0.010,
        0.002,
        0.021,
        -0.018,
        0.009,
        -0.016,
        0.010,
        0.012,
        0.002,
        -0.003,
        -0.010,
        0.020,
        0.003,
        0.008,
        0.010,
        0.030,
        0.015,
        -0.016,
        0.023,
        0.015,
        0.005,
        0.009,
        0.009,
        0.023,
        0.005,
        0.013,
        0.005,
        0.022,
        0.000,
        -0.008,
        0.000,
        0.024,
        0.003,
        -0.003,
        -0.000,
        -0.008,
        0.003,
        -0.011,
        0.009,
        0.027,
        -0.011,
        0.004,
        0.003,
        -0.001,
        0.015,
        0.005,
        0.003,
        0.001,
        0.016,
        -0.006,
        0.012,
        0.010,
        0.024,
        0.001,
        0.004,
        -0.012,
        0.008,
        0.006,
        -0.006,
        0.022,
        0.002,
        0.005,
        0.007,
        0.003,
        0.009,
        0.015,
        0.010,
        0.011,
        0.008,
        0.007,
        -0.008,
        0.040,
        0.029,
        0.028,
        0.023,
        -0.005,
        0.005,
        0.026,
        0.002,
        0.003,
        0.006,
        0.037,
        0.021,
        0.011,
        0.012,
        0.007,
        0.015,
        0.025,
        0.024,
        -0.002,
        0.017,
        0.026,
        -0.002,
        0.016,
        0.005,
        0.004,
        0.013,
        0.016,
        -0.010,
        -0.005,
        -0.004,
        0.005,
        -0.004,
        0.011,
        0.015,
        0.018,
        0.018,
        0.006,
        -0.002,
        0.005,
        0.017,
        0.003,
        0.007,
        0.002,
        -0.017,
        0.013,
        0.003,
        -0.009,
        0.009,
        0.012,
        0.004,
        0.004,
        0.012,
        0.006,
        -0.012,
        -0.015,
        0.000,
        0.019,
        0.019,
        0.023,
        -0.016,
        0.010,
        0.012,
        0.003,
        0.003,
        0.016,
        0.002,
        0.022,
        0.000,
        0.002,
        -0.003,
        0.003,
        -0.006,
        0.014,
        0.002,
        0.001,
        -0.003,
        -0.006,
        0.021,
        0.003,
        0.012,
        0.004,
        0.000,
        0.013,
        0.011,
        0.002,
        0.004,
        -0.007,
        -0.001,
        0.028,
        0.000,
        -0.007,
        0.002,
        0.004,
        0.033,
        0.006,
        -0.007,
        -0.004,
        0.001,
        0.007,
        0.020,
        0.027,
        0.002,
        -0.004,
        0.007,
        0.022,
        -0.018,
        0.012,
        0.015,
        0.004,
        -0.013,
        0.016,
        0.019,
        0.016,
        0.012,
        0.010,
        0.014,
        -0.002,
        0.012,
        0.027,
        0.008,
        0.024,
        0.002,
        0.022,
        -0.012,
        -0.000,
        0.012,
        0.034,
        -0.010,
        0.009,
        0.012,
        0.028,
        0.010,
        0.007,
        -0.015,
        -0.005,
        -0.022,
        0.017,
        0.020,
        -0.005,
        0.005,
        -0.002,
        0.002,
        0.022,
        -0.003,
        0.027,
        0.011,
        -0.006,
        0.012,
        -0.011,
        0.005,
        -0.003,
        -0.012,
        -0.007,
        0.012,
        0.016,
        0.000,
        -0.012,
        0.019,
        0.001,
        0.001,
        0.014,
        0.014,
        -0.002,
        0.019,
        0.010,
        0.001,
        0.002,
        0.011,
        0.015,
        0.022,
        0.005,
        0.000,
        0.003,
        0.002,
        -0.002,
        0.005,
        -0.009,
        0.027,
        0.005,
        0.004,
        0.016,
        -0.000,
        0.000,
        0.004,
        -0.005,
        0.022,
        -0.011,
        0.034,
        0.007,
        0.011,
        0.009,
        -0.009,
        0.014,
        0.022,
        0.013,
        0.005,
        0.008,
        -0.010,
        -0.010,
        -0.002,
        0.009,
        -0.002,
        0.012,
        0.012,
        0.003,
        0.004,
        0.023,
        -0.002,
        -0.012,
        -0.002,
        0.006,
        -0.002,
        0.016,
        0.010,
        0.012,
        0.002,
        0.006,
        0.010,
        -0.007,
        -0.004,
        -0.008,
        -0.008,
        0.009,
        0.008,
        0.012,
        0.011,
        0.006,
        0.028,
        0.003,
        -0.008,
        0.019,
        -0.005,
        0.010,
        -0.000,
        0.002,
        0.016,
        0.008,
        -0.006,
        -0.008,
        0.019,
        0.016,
        0.009,
        -0.027,
        0.017,
        -0.006,
        -0.022,
        0.001,
        0.015,
        0.007,
        0.027,
        0.002,
        -0.007,
        -0.002,
        0.012,
        0.008,
        0.027,
        0.011,
        0.017,
        0.005,
        -0.002,
        -0.012,
        0.006,
        -0.007,
        0.003,
        0.003,
        0.013,
        0.003,
        -0.014,
        0.011,
        0.014,
        -0.007,
        -0.011,
        0.000,
        0.027,
        -0.006,
        0.023,
        -0.012,
        -0.005,
        0.011,
        0.001,
        -0.013,
        0.007,
        0.017,
        0.017,
        -0.012,
        0.019,
        0.013,
        -0.013,
        -0.003,
        0.013,
        0.024,
        -0.002,
        0.017,
        0.026,
        0.003,
        0.026,
        0.022,
        -0.000,
        0.003,
        0.007,
        0.023,
        0.012,
        0.000,
        0.019,
        0.016,
        -0.004,
        0.029,
        0.016,
        0.007,
        0.019,
        0.028,
        0.002,
        0.027,
        -0.002,
        0.005,
        -0.001,
        -0.002,
        0.001,
        -0.007,
        0.022,
        0.010,
        0.011,
        0.004,
        0.025,
        0.008,
        -0.009,
        -0.009,
        -0.008,
        0.003,
        -0.002,
        0.028,
        0.024,
        0.009,
        0.025,
        -0.001,
        -0.011,
        -0.006,
        -0.011,
        -0.001,
        0.025,
        0.009,
        0.001,
        0.005,
        0.000,
        0.014,
        0.007,
        -0.015,
        0.012,
        0.027,
        -0.012,
        0.018,
        0.002,
        0.006,
        0.002,
        -0.015,
        0.027,
        0.022,
        0.024,
        -0.000,
        0.005,
        0.014,
        0.005,
        0.002,
        0.007,
        0.006,
        0.008,
        -0.003,
        -0.005,
        0.017,
        0.014,
        0.003,
        0.024,
        0.020,
        0.033,
        0.013,
        0.018,
        0.015,
        0.020,
        0.019,
        0.009,
        -0.005,
        -0.001,
        0.013,
        -0.038,
        0.024,
        0.012,
        0.007,
        -0.002,
        -0.025,
        0.012,
        0.016,
        0.017,
        0.015,
        0.009,
        0.008,
        0.018,
        0.007,
        -0.007,
        0.033,
        0.015,
        -0.014,
        0.013,
        0.029,
        0.020,
        0.021,
        0.005,
        0.001,
        0.020,
        -0.003,
        0.025,
        0.011,
        -0.016,
        0.018,
        -0.020,
        0.005,
        -0.002,
        -0.007,
        -0.006,
        0.005,
        0.006,
        0.012,
        0.004,
        -0.004,
        0.009,
        -0.000,
        0.014,
        0.017,
        0.017,
        0.004,
        0.007,
        0.018,
        -0.000,
        0.014,
        0.013,
        -0.005,
        0.005,
        -0.016,
        0.011,
        -0.008,
        0.001,
        -0.020,
        0.025,
        -0.010,
        0.010,
        0.033,
        0.024,
        0.014,
        -0.004,
        -0.029,
        0.018,
        0.004,
        0.012,
        -0.011,
        0.013,
        0.023,
        0.009,
        -0.008,
        -0.004,
        -0.001,
        0.018,
        0.007,
        -0.003,
        -0.015,
        0.015,
        0.007,
        -0.010,
        0.034,
        0.034,
        0.033,
        -0.014,
        0.007,
        0.003,
        -0.022,
        0.014,
        0.024,
        0.007,
        0.022,
        0.021,
        0.018,
        0.016,
        -0.002,
        -0.000,
        -0.002,
        0.004,
        0.008,
        -0.014,
        0.025,
        0.004,
        0.021,
        0.021,
        0.018,
        0.005,
        -0.008,
        -0.004,
        0.018,
        -0.007,
        0.013,
        0.035,
        -0.001,
        0.023,
        0.013,
        -0.019,
        0.002,
        -0.002,
        -0.004,
        -0.005,
        0.006,
        0.036,
        0.009,
        0.006,
        0.003,
        -0.008,
        0.004,
        0.006,
        -0.018,
        0.009,
        -0.020,
        0.000,
        0.011,
        0.018,
        0.008,
        0.001,
        0.055,
        0.028,
        0.011,
        0.019,
        -0.008,
        -0.010,
        0.004,
        0.005,
        0.006,
        0.004,
        0.007,
        0.010,
        0.004,
        0.000,
        0.002,
        0.004,
        0.020,
        -0.021,
        0.015
    ]

    let accounts: Account[] = []
    let tax1 = new Account('1', 'tax1', 1, 10);
    let brok1 = new Account('2', 'brok1', 0, 90);

    let currentDateIndex = 1;

    let balances: BalanceData = {}

    accounts.push(tax1)
    accounts.push(brok1)

    balances[tax1.id] = [20000]
    balances[brok1.id] = [150000]


    it('test projectWithReturn Happy Case no glide path', async () => {
        const sim = new Simulation('1', '', 1, '', '', new Date(), '', SimulationStatus.Running);

        const inputs: MonteCarloInputs = {
            accounts: accounts,
            input: new Input('1', new Date(1996, 5, 25), false, new AssetAllocation(new Allocations('80', '15', '5'), undefined, undefined), sim.id),
            assets: [
                new Asset('', '', 1, 1, '', 0)
            ],
            simulation: sim,
            budgets: [
                new Budget('1', 'budeget', new Date(2022, 7, 1), new Date(2096, 4, 25), [new Category('', 'exp', 5830)], CategoryTypes.Expense),
                new Budget('2', 'incomes', new Date(2022, 7, 1), new Date(2031, 4, 25), [new Category('', 'income', 10500)], CategoryTypes.Income),

            ],
            events: [
                new Event('1', 'event', new Date(2030, 5, 1), brok1.name, new Category('', 'income', 100), CategoryTypes.Income),
                new Event('2', 'event', new Date(2031, 5, 1), brok1.name, new Category('', 'expense', 80000), CategoryTypes.Expense)
            ]
        }
        const dateIm59 = new Date(inputs.input.birthday);
        dateIm59.setFullYear(dateIm59.getFullYear() + 59);

        const dates = dateRange(new Date(2022, 7, 1), new Date(2096, 4, 25));


        expect(growthRates.length).toEqual(dates.length);
        const res = projectWithReturn(balances, inputs, dateIm59, dates, growthRates);
        const last = res[res.length - 1];
        const expected = {
            "date": new Date("2096-05-01T07:00:00.000Z"),
            "brokerageBal": "6800611.69",
            "taxBal": "0.00",
            "sum": "6800611.69",
            "return": "1.50",
            "note": "",
            "accountUsed": "brok1",
            "events": [],
            "incomeExpenses": "-5830.00"
        };

        expect(last).toEqual(expected)

    });

});